<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHANNEL MASTER | Global</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1661799910335681" crossorigin="anonymous"></script>

    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background-color: #000; color: #fff; padding: 0; margin: 0; user-select: none; overflow: hidden; touch-action: manipulation; display: flex; flex-direction: column; height: 100dvh; }
        #ad-container { width: 100%; height: 50px; background-color: #222; flex-shrink: 0; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #444; z-index: 1000; }
        .ad-placeholder { color: #666; font-size: 0.7em; }
        .container { width: 100%; max-width: 420px; margin: 0 auto; padding: 10px 15px; flex-grow: 1; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; position: relative; z-index: 10; background-color: #121212; }
        
        /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .shake-small { animation: shake 0.15s; }
        .shake-big { animation: shake 0.4s; }
        @keyframes shake { 0% { transform: translate(2px, 2px); } 25% { transform: translate(-2px, -2px); } 50% { transform: translate(2px, -2px); } 75% { transform: translate(-2px, 2px); } 100% { transform: translate(0, 0); } }
        .flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 80; opacity: 0; }
        .flash-anim { animation: screenFlash 0.3s ease-out; }
        @keyframes screenFlash { 0% { background-color: rgba(255, 255, 255, 0.9); opacity: 1; } 100% { background-color: transparent; opacity: 0; } }
        .particle { position: fixed; width: 8px; height: 8px; border-radius: 50%; pointer-events: none; z-index: 90; animation: particleFade 0.6s ease-out forwards; }
        @keyframes particleFade { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(0); opacity: 0; } }
        .cutin-text { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 4em; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.8), 4px 4px 0px #000; z-index: 95; pointer-events: none; white-space: nowrap; animation: cutIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes cutIn { 0% { transform: translate(-50%, -50%) scale(0) rotate(-15deg); opacity: 0; } 50% { transform: translate(-50%, -50%) scale(1.3) rotate(0deg); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; } }
        .popup-text { position: absolute; font-weight: 900; font-size: 1.8em; pointer-events: none; text-shadow: 3px 3px 0px rgba(0,0,0,1); z-index: 60; animation: popUp 0.6s ease-out forwards; }
        @keyframes popUp { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 20% { transform: translateY(-30px) scale(1.3); opacity: 1; } 100% { transform: translateY(-80px) scale(1.0); opacity: 0; } }

        /* UI */
        .top-bar { display: flex; justify-content: space-between; padding: 5px 15px; background: #1e1e1e; border-radius: 8px; font-weight: bold; margin-bottom: 5px; border-bottom: 2px solid #ffd700; flex-shrink: 0; }
        .score-board { margin-bottom: 5px; flex-shrink: 0; }
        .score-val { font-size: 2.5em; font-weight: 800; line-height: 1; color: #fff; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);}
        .enemy-container { position: relative; width: 100%; margin: 0 auto 5px; background: #252525; border-radius: 12px; padding: 10px 0; border: 2px solid #555; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; flex-shrink: 0; }
        .viewer-comment { position: absolute; top: -10px; background: #fff; color: #000; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8em; border: 2px solid #000; }
        .resource-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; background: #1e1e1e; padding: 6px; border-radius: 8px; margin-bottom: 5px; border: 1px solid #333; flex-shrink: 0; }
        .res-rate { font-size: 0.8em; color: #ffd700; font-weight: 800;} 
        .item-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; flex-shrink: 0; }
        .btn-item { padding: 8px; border: none; border-radius: 8px; font-weight: bold; color: white; background: #2f2f35; border-bottom: 3px solid #1a1a1d; }
        .btn-item:disabled { opacity: 0.3; }

        /* æ“ä½œãƒ‘ãƒãƒ«ï¼šé«˜ã•ã‚’å®Œå…¨ã«å›ºå®š */
        .control-panel { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; height: 85px; flex-shrink: 0;}
        .special-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; height: 85px; flex-shrink: 0;}
        .btn-action { height: 100%; border: none; border-radius: 12px; color: white; cursor: pointer; position: relative; box-shadow: 0 6px 0 rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: center; align-items: center; transition: all 0.05s; overflow: hidden; }
        .btn-action:active { transform: translateY(6px); box-shadow: none; margin-bottom: 6px; }
        
        /* ãƒ©ãƒ™ãƒ«ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn-main-text { font-size: 11px; font-weight: 900; margin-bottom: 2px; text-shadow: 0 1px 2px rgba(0,0,0,0.8); }
        .btn-sub-text { font-size: 9px; font-weight: 900; background: rgba(0,0,0,0.7); padding: 2px 6px; border-radius: 10px; min-width: 80%; }

        .bg-red { background: linear-gradient(135deg, #ef476f, #d6336c); }
        .bg-blue { background: linear-gradient(135deg, #118ab2, #073b4c); }
        .bg-green { background: linear-gradient(135deg, #06d6a0, #059669); }
        .bg-white { background: linear-gradient(135deg, #f8f9fa, #dee2e6); color: #333; }
        .bg-black { background: linear-gradient(135deg, #9b5de5, #5a189a); }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .box-style { background: #1f1f23; padding: 30px; border-radius: 16px; border: 2px solid #ffd700; width: 85%; max-width: 380px; text-align: center; }
        .main-btn { margin-top: 15px; padding: 15px 40px; font-size: 1.2em; font-weight: bold; background: linear-gradient(90deg, #ffd700, #e6ac00); color: #000; border: none; border-radius: 30px; width: 100%;}
        .privacy-link { color: #666; font-size: 0.7em; margin-top: 20px; text-decoration: underline; }
        .boost-overlay { position: fixed; top:0; left:0; width:100%; height:100%; border: 4px solid #f1c40f; pointer-events: none; display: none; z-index: 50; animation: pulseBorder 0.8s infinite; }
        @keyframes pulseBorder { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="ad-container"><div class="ad-placeholder">[ AD SPACE ]</div></div>
<div id="flash-fx" class="flash-overlay"></div>
<div id="boost-fx" class="boost-overlay"></div>

<div id="title-screen" class="overlay">
    <div class="box-style">
        <div style="font-size:2.5em; font-weight:900; line-height:1.1;">CHANNEL<br><span style="color:#ffd700">MASTER</span></div>
        <div style="color:#888; margin-bottom:30px;">Global Edition</div>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button id="lang-jp" onclick="setLang('ja')" style="flex:1; padding:10px; border-radius:8px; background:#222; color:#fff; border:2px solid #ffd700;">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
            <button id="lang-en" onclick="setLang('en')" style="flex:1; padding:10px; border-radius:8px; background:#222; color:#888; border:2px solid #444;">ğŸ‡ºğŸ‡¸ English</button>
        </div>
        <div style="background:#000; padding:10px; border-radius:8px; margin-bottom:20px; border:1px solid #333;">
            <div id="lbl-best" style="font-size:0.8em; color:#888;">PERSONAL BEST</div>
            <div style="font-size:1.5em; font-weight:bold; color:#ffd700;">Â¥ <span id="title-high-score">0</span></div>
        </div>
        <button class="main-btn" onclick="startGame()" id="btn-start">START STREAM</button>
        <a class="privacy-link" href="privacy.html">Privacy Policy</a>
    </div>
</div>

<div class="container" id="main-container">
    <div class="top-bar"><div>CHANNEL MASTER</div><div style="color:#88ccff; font-weight:800;"><span id="lbl-turn-pre"></span> <span id="turn">30</span> <span id="lbl-turn-suf"></span></div></div>
    <div class="score-board">
        <div style="font-size:0.8em; color:#ffd700; font-weight:bold;" id="lbl-score">ESTIMATED REVENUE</div>
        <div class="score-val">Â¥<span id="score">0</span></div>
        <div style="color:#f1c40f; font-style:italic; font-weight:bold;"><span id="combo">0</span> Buzz Chain!</div>
    </div>
    <div class="enemy-container" id="enemy-box"><div class="viewer-comment" id="viewer-comment">---</div><div style="position:absolute; top:10px; right:10px; background:#333; padding:2px 6px; border-radius:6px; font-size:0.7em;">Lv.<span id="level">1</span></div><div id="enemy-icon" style="font-size:3.2em;">ğŸ”´</div><div id="enemy-name" style="font-weight:bold;">---</div></div>
    <div class="resource-area">
        <div>ğŸ”¥<span id="res-red-val">0</span><br><span class="res-rate" id="rate-red">+0.00x</span></div>
        <div>â„ï¸<span id="res-blue-val">0</span><br><span class="res-rate" id="rate-blue">+0.00x</span></div>
        <div>ğŸ€<span id="res-green-val">0</span><br><span class="res-rate" id="rate-green">+0.00x</span></div>
        <div style="grid-column: span 3; border-top:1px solid #333; margin-top:4px; font-weight:900;"><span id="lbl-total">TOTALå€ç‡</span>: x<span id="b-total">1.00</span></div>
    </div>
    <div class="item-area">
        <button class="btn-item" id="btn-boost" onclick="useBooster(event)"><span style="color:#f1c40f;">ğŸ¬ BOOST</span><br><span id="lbl-boost-desc" style="font-size:0.7em;"></span></button>
        <button class="btn-item" id="btn-recover" onclick="useRecover(event)"><span style="color:#88ccff;">â° TIME</span><br><span id="lbl-time-desc" style="font-size:0.7em;"></span></button>
    </div>
    <div class="control-panel">
        <button class="btn-action bg-red" onclick="battle('red', event)"><div>ğŸ”¥</div><span class="btn-main-text" id="main-red">---</span><span class="btn-sub-text" id="sub-red">---</span></button>
        <button class="btn-action bg-blue" onclick="battle('blue', event)"><div>â„ï¸</div><span class="btn-main-text" id="main-blue">---</span><span class="btn-sub-text" id="sub-blue">---</span></button>
        <button class="btn-action bg-green" onclick="battle('green', event)"><div>ğŸ€</div><span class="btn-main-text" id="main-green">---</span><span class="btn-sub-text" id="sub-green">---</span></button>
    </div>
    <div class="special-row">
        <button class="btn-action bg-white" onclick="battle('white', event)"><div style="font-size:0.7em; font-weight:900;">ğŸ¤ COLLAB</div><span class="btn-main-text" id="main-white">---</span><span class="btn-sub-text" id="sub-white">---</span></button>
        <button class="btn-action bg-black" onclick="battle('black', event)"><div style="font-size:0.7em; font-weight:900;">ğŸ‘» PRANK</div><span class="btn-main-text" id="main-black">---</span><span class="btn-sub-text" id="sub-black">---</span></button>
    </div>
</div>

<div id="result-overlay" class="overlay" style="display:none;">
    <div class="box-style">
        <div style="font-weight:bold; color:#888; margin-bottom:10px;">STREAM ENDED</div>
        <div style="font-size:2.5em; font-weight:900; color:#ffd700; margin-bottom:20px;">Â¥<span id="res-final">0</span></div>
        <button class="main-btn" onclick="shareOnX()">ğ• SHARE</button>
        <button class="main-btn" style="background:#444; color:#fff;" onclick="backToTitle()">TITLE</button>
    </div>
</div>

<script>
    const Vibrate = {
        short: () => { if (navigator.vibrate) navigator.vibrate(15); }, 
        medium: () => { if (navigator.vibrate) navigator.vibrate(40); }, 
        long: () => { if (navigator.vibrate) navigator.vibrate([60, 50, 60]); }
    };

    const Sound = {
        ctx: null,
        init: function() { try { window.AudioContext = window.AudioContext || window.webkitAudioContext; this.ctx = new AudioContext(); } catch(e){} },
        playTone: function(f, d, v=0.1) {
            if (!this.ctx) return;
            const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
            o.frequency.setValueAtTime(f, this.ctx.currentTime); g.gain.setValueAtTime(v, this.ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + d);
            o.connect(g); g.connect(this.ctx.destination); o.start(); o.stop(this.ctx.currentTime + d);
        }
    };

    const TYPES = [
        { id: 'red', icon: 'ğŸ”¥', color: '#ff6b6b', ja: { name: 'ãƒ‘ãƒƒã‚·ãƒ§ãƒ³', comment: 'ç†±ã„å±•é–‹é ¼ã‚€ï¼' }, en: { name: 'Passion', comment: 'Hot!' } },
        { id: 'blue', icon: 'â„ï¸', color: '#4facfe', ja: { name: 'ã‚¯ãƒ¼ãƒ«', comment: 'å†·é™ã«ã€‚' }, en: { name: 'Cool', comment: 'Chill.' } },
        { id: 'green', icon: 'ğŸ€', color: '#43e97b', ja: { name: 'ãƒãƒ«', comment: 'ã¾ã£ãŸã‚Šã—ã‚ˆã€‚' }, en: { name: 'Chill', comment: 'Relax.' } },
        { id: 'white', icon: 'ğŸ¤', color: '#ffffff', ja: { name: 'VIP', comment: 'ã‚³ãƒ©ãƒœå¾…æ©Ÿã€‚' }, en: { name: 'VIP', comment: 'Wait collab.' } },
        { id: 'black', icon: 'ğŸ‘¾', color: '#a0a0a0', ja: { name: 'ãƒãƒ‹ã‚¢', comment: 'åˆºæ¿€ãŒæ¬²ã—ã„ã€‚' }, en: { name: 'Maniac', comment: 'Need fun.' } }
    ];

    let turn, score, combo, level, resources, boostCount, recoverCount, isBoostActive, currentEnemy, highScore = 0;
    let CUR_LANG = 'ja';

    const TEXT = {
        ja: { turnPre: "æ®‹ã‚Š", turnSuf: "æ ", score: "æ¨å®šåç›Š", total: "TOTALå€ç‡", boost: "æ®‹:", time: "æ®‹:", start: "é…ä¿¡é–‹å§‹", best: "ãƒ™ã‚¹ãƒˆ", share: "åç›Š Â¥{score} é”æˆï¼" },
        en: { turnPre: "Turns:", turnSuf: "", score: "REVENUE", total: "Multiplier", boost: "L:", time: "L:", start: "START", best: "BEST", share: "Earned Â¥{score}!" }
    };

    function setLang(l) { 
        CUR_LANG = l; 
        document.getElementById('lang-jp').style.borderColor = l==='ja'?'#ffd700':'#444';
        document.getElementById('lang-en').style.borderColor = l==='en'?'#ffd700':'#444';
        updateUI(); 
    }

    function startGame() {
        document.getElementById('title-screen').style.display = 'none';
        turn = 30; score = 0; combo = 0; level = 1; resources = { red:0, blue:0, green:0 };
        boostCount = 3; recoverCount = 3; isBoostActive = false;
        highScore = localStorage.getItem('cm_highscore_v1') || 0;
        document.getElementById('title-high-score').innerText = parseInt(highScore).toLocaleString();
        Sound.init(); spawnEnemy(); updateUI();
    }

    function spawnEnemy() {
        currentEnemy = TYPES[Math.floor(Math.random() * TYPES.length)];
        updateUI();
    }

    function getMatchup(p, e) {
        if (e === 'white') return (p === 'white') ? 'advantage' : 'extract';
        if (e === 'black') return (p === 'black') ? 'advantage' : 'extract';
        if (p === 'white' || p === 'black') return 'extract';
        if (p === e) return 'advantage';
        if ((e === 'red' && p === 'blue') || (e === 'blue' && p === 'green') || (e === 'green' && p === 'red')) return 'neutral';
        return 'extract';
    }

    function calculateOutcome(pType) {
        if (!currentEnemy) return { score:0, res:0, label:"", type:"" };
        const match = getMatchup(pType, currentEnemy.id);
        const base = 100 * (1 + (level * 0.1)); // ãƒ¬ãƒ™ãƒ«è£œæ­£ã‚’ç·©ã‚„ã‹ã«
        let s = 0, r = 0, lbl = "";

        if (match === 'advantage') {
            s = Math.floor(base * (1 + (combo * 0.2))); r = 3; lbl = "Buzz!";
        } else if (match === 'neutral') {
            s = Math.floor(base * 0.6 * (1 + (combo * 0.1))); r = 6; lbl = "Keep";
        } else {
            s = Math.floor(base * 0.2); r = (pType==='white'||pType==='black') ? 12 : 9; lbl = "Promo";
        }
        if (isBoostActive) s *= 2;
        return { score: s, res: r, label: lbl, type: match };
    }

    function battle(pType, e) {
        if (turn <= 0) return;
        const out = calculateOutcome(pType);
        if (out.type === 'advantage' || out.type === 'neutral') combo++; else combo = 0;
        
        if (pType === 'white' || pType === 'black') {
            resources.red += out.res/3; resources.blue += out.res/3; resources.green += out.res/3;
        } else { resources[pType] += out.res; }

        score += out.score; turn--; level++;
        if (out.type === 'advantage') Vibrate.short(); else if (out.type === 'neutral') Vibrate.medium();
        
        // ã‚¢ã‚¤ãƒ†ãƒ ãƒ‰ãƒ­ãƒƒãƒ—
        if (out.type === 'advantage' && Math.random() < 0.1 && recoverCount < 5) recoverCount++;
        if (out.type === 'extract' && Math.random() < 0.1 && boostCount < 5) boostCount++;

        isBoostActive = false;
        spawnEnemy(); if (turn <= 0) showResult();
    }

    function showResult() {
        const m = 1 + (resources.red + resources.blue + resources.green) / 30;
        const final = Math.floor(score * m);
        document.getElementById('res-final').innerText = final.toLocaleString();
        document.getElementById('result-overlay').style.display = 'flex';
        if (final > highScore) localStorage.setItem('cm_highscore_v1', final);
    }

    function backToTitle() { location.reload(); }

    function useBooster(e) { if(boostCount>0 && !isBoostActive) { boostCount--; isBoostActive=true; Vibrate.long(); updateUI(); } }
    function useRecover(e) { if(recoverCount>0) { recoverCount--; turn++; Vibrate.long(); updateUI(); } }

    function updateUI() {
        const T = TEXT[CUR_LANG];
        document.getElementById('turn').innerText = turn;
        document.getElementById('score').innerText = score.toLocaleString();
        document.getElementById('combo').innerText = combo;
        document.getElementById('level').innerText = level;
        document.getElementById('res-red-val').innerText = Math.floor(resources.red);
        document.getElementById('res-blue-val').innerText = Math.floor(resources.blue);
        document.getElementById('res-green-val').innerText = Math.floor(resources.green);
        
        const m = 1 + (resources.red + resources.blue + resources.green) / 30;
        document.getElementById('b-total').innerText = m.toFixed(2);
        document.getElementById('lbl-boost-desc').innerText = `${T.boost}${boostCount}`;
        document.getElementById('lbl-time-desc').innerText = `${T.time}${recoverCount}`;
        document.getElementById('boost-fx').style.display = isBoostActive ? 'block' : 'none';

        if (currentEnemy) {
            document.getElementById('enemy-icon').innerText = currentEnemy.icon;
            document.getElementById('enemy-name').innerText = currentEnemy[CUR_LANG].name;
            document.getElementById('viewer-comment').innerText = currentEnemy[CUR_LANG].comment;
            document.getElementById('enemy-box').style.borderColor = currentEnemy.color;
        }

        ['red','blue','green','white','black'].forEach(t => {
            const res = calculateOutcome(t);
            const main = document.getElementById(`main-${t}`);
            const sub = document.getElementById(`sub-${t}`);
            main.innerText = `+Â¥${res.score}`;
            sub.innerText = `${res.label} | +${res.res}`;

            // è‰²ã®å¾©æ—§ï¼šBuzzã¯é»„è‰²ã€Keepã¯ç™½ã€Promoã¯é’
            if (res.label === "Buzz!") { sub.style.color = "#f1c40f"; main.style.color = "#f1c40f"; }
            else if (res.label === "Keep") { sub.style.color = "#fff"; main.style.color = "#fff"; }
            else { sub.style.color = "#88ccff"; mainLbl = main.style.color = "#88ccff"; }
        });
    }

    function shareOnX() {
        const final = document.getElementById('res-final').innerText;
        const txt = TEXT[CUR_LANG].share.replace("{score}", final);
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(txt)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }
</script>
</body>
</html>
