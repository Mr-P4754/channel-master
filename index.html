<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHANNEL MASTER | Global</title>
    
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1661799910335681" crossorigin="anonymous"></script>

    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; background-color: #000; color: #fff; padding: 0; margin: 0; user-select: none; overflow: hidden; touch-action: manipulation; display: flex; flex-direction: column; height: 100dvh; }
        #ad-container { width: 100%; height: 50px; background-color: #222; flex-shrink: 0; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #444; z-index: 1000; }
        .container { width: 100%; max-width: 420px; margin: 0 auto; padding: 10px 15px; flex-grow: 1; box-sizing: border-box; display: flex; flex-direction: column; justify-content: center; position: relative; z-index: 10; background-color: #121212; }
        
        .top-bar { display: flex; justify-content: space-between; padding: 5px 15px; background: #1e1e1e; border-radius: 8px; font-weight: bold; margin-bottom: 5px; border-bottom: 2px solid #ffd700; flex-shrink: 0; }
        .score-val { font-size: 2.5em; font-weight: 800; line-height: 1; color: #fff; text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);}
        .enemy-container { position: relative; width: 100%; margin: 0 auto 5px; background: #252525; border-radius: 12px; padding: 10px 0; border: 2px solid #555; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; flex-shrink: 0; }
        .viewer-comment { position: absolute; top: -10px; background: #fff; color: #000; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8em; border: 2px solid #000; white-space: nowrap; z-index: 20;}
        
        .resource-area { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; background: #1e1e1e; padding: 6px; border-radius: 8px; margin-bottom: 5px; border: 1px solid #333; flex-shrink: 0; }
        .res-item { font-size: 0.9em; font-weight: bold; padding: 4px 0; }
        .res-rate { font-size: 0.75em; color: #ffd700; display: block; margin-top: 2px; }

        .item-area { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; flex-shrink: 0; }
        .btn-item { padding: 8px; border: none; border-radius: 8px; font-weight: bold; color: white; background: #2f2f35; border-bottom: 3px solid #1a1a1d; font-size: 0.85em;}
        .btn-item:active { transform: translateY(2px); border-bottom: 1px solid #1a1a1d; }
        .btn-item:disabled { opacity: 0.3; pointer-events: none; }
        
        .control-panel { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; height: 85px; flex-shrink: 0;}
        .special-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; height: 85px; flex-shrink: 0;}
        .btn-action { height: 100%; border: none; border-radius: 12px; color: white; cursor: pointer; position: relative; box-shadow: 0 6px 0 rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: center; align-items: center; transition: all 0.05s; overflow: hidden; }
        .btn-action:active { transform: translateY(6px); box-shadow: none; margin-bottom: 6px; }
        .btn-main-text { font-size: 11px; font-weight: 900; margin-bottom: 2px; }
        .btn-sub-text { font-size: 9px; font-weight: 900; background: rgba(0,0,0,0.7); padding: 2px 6px; border-radius: 10px; min-width: 80%; }

        .bg-red { background: linear-gradient(135deg, #ef476f, #d6336c); }
        .bg-blue { background: linear-gradient(135deg, #118ab2, #073b4c); }
        .bg-green { background: linear-gradient(135deg, #06d6a0, #059669); }
        .bg-white { background: linear-gradient(135deg, #f8f9fa, #dee2e6); color: #333; }
        .bg-black { background: linear-gradient(135deg, #9b5de5, #5a189a); }

        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .res-box { background: #1f1f23; padding: 20px; border-radius: 16px; border: 2px solid #ffd700; width: 90%; max-width: 380px; text-align: center; }
        .res-grid { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; text-align: left; }
        .res-item-row { display: flex; justify-content: space-between; font-size: 0.9em; }
        .res-divider { height: 1px; background: #444; margin: 4px 0; }
        .res-total-val { font-size: 2.8em; font-weight: 900; color: #ffd700; text-shadow: 0 0 15px rgba(255,215,0,0.4); margin: 10px 0;}
        .main-btn { margin-top: 10px; padding: 15px; font-size: 1.2em; font-weight: bold; background: linear-gradient(90deg, #ffd700, #e6ac00); color: #000; border: none; border-radius: 10px; width: 100%; cursor: pointer;}
        .sub-btn { margin-top: 10px; padding: 15px; font-size: 1.2em; font-weight: bold; background: #444; color: #fff; border: none; border-radius: 10px; width: 100%; cursor: pointer;}
        .boost-overlay { position: fixed; top:0; left:0; width:100%; height:100%; border: 4px solid #f1c40f; pointer-events: none; display: none; z-index: 50; }
        
        .lang-btn { flex: 1; padding: 10px; border-radius: 8px; background: #222; color: #888; border: 2px solid #444; font-weight: bold; }
        .lang-btn.active { color: #fff; border-color: #ffd700; background: #333; }
    </style>
</head>
<body>

<div id="ad-container"><div class="ad-placeholder">[ AD SPACE ]</div></div>
<div id="boost-fx" class="boost-overlay"></div>

<div id="title-screen" class="overlay">
    <div class="res-box">
        <div style="font-size:2.5em; font-weight:900;">CHANNEL<br><span style="color:#ffd700">MASTER</span></div>
        <p style="color:#888;">Global Edition</p>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="lang-btn" id="lang-ja" onclick="setLang('ja')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
            <button class="lang-btn" id="lang-en" onclick="setLang('en')">ğŸ‡ºğŸ‡¸ English</button>
        </div>
        <div style="background:#000; padding:10px; border-radius:8px; margin:10px 0; border:1px solid #333;">
            <div id="title-best-label" style="font-size:0.8em; color:#888;">PERSONAL BEST</div>
            <div style="font-size:1.5em; font-weight:bold; color:#ffd700;">Â¥ <span id="title-hs">0</span></div>
        </div>
        <button class="main-btn" onclick="startGame()" id="btn-start-label">START STREAM</button>
        <a href="privacy.html" style="color:#666; font-size:0.7em; display:block; margin-top:15px;">Privacy Policy</a>
    </div>
</div>

<div class="container" id="main-container">
    <div class="top-bar"><div>CHANNEL MASTER</div><div style="color:#88ccff;"><span id="ui-turn">30</span> <span id="ui-turn-label">Turns Left</span></div></div>
    <div class="score-board">
        <div style="font-size:0.8em; color:#ffd700; font-weight:bold;" id="ui-score-label">ESTIMATED REVENUE</div>
        <div class="score-val">Â¥<span id="ui-score">0</span></div>
        <div style="color:#f1c40f; font-weight:bold;"><span id="ui-combo">0</span> Buzz Chain!</div>
    </div>
    <div class="enemy-container" id="enemy-box">
        <div class="viewer-comment" id="ui-comment">---</div>
        <div id="ui-enemy-icon" style="font-size:3.2em;">ğŸ”´</div>
        <div id="ui-enemy-name" style="font-weight:bold;">---</div>
        <div style="position:absolute; top:10px; right:10px; background:#333; padding:2px 6px; border-radius:6px; font-size:0.7em;">Lv.<span id="ui-level">1</span></div>
    </div>
    <div class="resource-area">
        <div class="res-item">ğŸ”¥ <span id="ui-res-red">0</span><br><span class="res-rate" id="ui-rate-red">+0.00x</span></div>
        <div class="res-item">â„ï¸ <span id="ui-res-blue">0</span><br><span class="res-rate" id="ui-rate-blue">+0.00x</span></div>
        <div class="res-item">ğŸ€ <span id="ui-res-green">0</span><br><span class="res-rate" id="ui-rate-green">+0.00x</span></div>
        <div style="grid-column: span 3; border-top:1px solid #333; padding-top:4px; font-weight:900;"><span id="ui-total-multiplier-label">TOTALå€ç‡</span>: x<span id="ui-rate-total">1.00</span></div>
    </div>
    <div class="item-area">
        <button class="btn-item" onclick="useBooster(event)" id="ui-btn-boost-label">ğŸ¬ BOOST (L:3)</button>
        <button class="btn-item" onclick="useRecover(event)" id="ui-btn-time-label">â° TIME (L:3)</button>
    </div>
    <div class="control-panel">
        <button class="btn-action bg-red" onclick="battle('red')">ğŸ”¥<span class="btn-main-text" id="btn-score-red"></span><span class="btn-sub-text" id="btn-lbl-red"></span></button>
        <button class="btn-action bg-blue" onclick="battle('blue')">â„ï¸<span class="btn-main-text" id="btn-score-blue"></span><span class="btn-sub-text" id="btn-lbl-blue"></span></button>
        <button class="btn-action bg-green" onclick="battle('green')">ğŸ€<span class="btn-main-text" id="btn-score-green"></span><span class="btn-sub-text" id="btn-lbl-green"></span></button>
    </div>
    <div class="special-row">
        <button class="btn-action bg-white" onclick="battle('white')"><span id="ui-collab-label" style="font-size:0.7em;font-weight:900;">ğŸ¤ COLLAB</span><span class="btn-main-text" id="btn-score-white"></span><span class="btn-sub-text" id="btn-lbl-white"></span></button>
        <button class="btn-action bg-black" onclick="battle('black')"><span id="ui-prank-label" style="font-size:0.7em;font-weight:900;">ğŸ‘» PRANK</span><span class="btn-main-text" id="btn-score-black"></span><span class="btn-sub-text" id="btn-lbl-black"></span></button>
    </div>
</div>

<div id="result-overlay" class="overlay" style="display:none;">
    <div class="res-box">
        <div style="font-size:1.5em; font-weight:900; color:#ffd700; border-bottom:1px solid #ffd700; padding-bottom:10px; margin-bottom:15px;" id="ui-res-title">é…ä¿¡ãƒªã‚¶ãƒ«ãƒˆ</div>
        <div class="res-grid" id="ui-res-grid"></div>
        <div style="font-size:0.9em; color:#aaa; margin-top:10px;" id="ui-res-final-label">æœ€çµ‚åç›Š</div>
        <div class="res-total-val">Â¥ <span id="ui-res-final">0</span></div>
        <button class="main-btn" onclick="shareOnX()" id="ui-res-share-label">ãƒã‚¹ãƒˆã™ã‚‹</button>
        <button class="sub-btn" onclick="backToTitle()" id="ui-res-title-label">ã‚¿ã‚¤ãƒˆãƒ«ã¸</button>
    </div>
</div>

<script>
    const Vibrate = {
        short: () => { if (navigator.vibrate) navigator.vibrate(15); }, 
        medium: () => { if (navigator.vibrate) navigator.vibrate(40); }, 
        long: () => { if (navigator.vibrate) navigator.vibrate([60, 50, 60]); }
    };

    const ENEMY_DATA = [
        { id: 'red', icon: 'ğŸ”¥', color: '#ff6b6b', ja: { name: 'ãƒ‘ãƒƒã‚·ãƒ§ãƒ³å‹¢', comment: 'ç†±ã„å±•é–‹é ¼ã‚€ï¼' }, en: { name: 'Passion Fan', comment: 'Make it hot!' } },
        { id: 'blue', icon: 'â„ï¸', color: '#4facfe', ja: { name: 'ã‚¯ãƒ¼ãƒ«å‹¢', comment: 'å†·é™ãªåˆ†æåŠ©ã‹ã‚‹ã€‚' }, en: { name: 'Cool Viewer', comment: 'Keep it calm.' } },
        { id: 'green', icon: 'ğŸ€', color: '#43e97b', ja: { name: 'ãƒãƒ«å‹¢', comment: 'ã¾ã£ãŸã‚Šé›‘è«‡ã€‚' }, en: { name: 'Chill Fan', comment: 'Relaxing vibes.' } },
        { id: 'white', icon: 'ğŸ¤', color: '#ffffff', ja: { name: 'VIPã‚²ã‚¹ãƒˆ', comment: 'ã‚³ãƒ©ãƒœå¾…ã£ã¦ã¾ã™ï¼' }, en: { name: 'VIP Guest', comment: 'Collab please!' } },
        { id: 'black', icon: 'ğŸ‘¾', color: '#a0a0a0', ja: { name: 'ãƒãƒ‹ã‚¢', comment: 'åˆºæ¿€ãŒæ¬²ã—ã„ã€‚' }, en: { name: 'Maniac', comment: 'Surprise me!' } }
    ];

    const UI_TEXT = {
        ja: {
            best: "è‡ªå·±ãƒ™ã‚¹ãƒˆ", start: "é…ä¿¡é–‹å§‹", turn: "æ  æ®‹ã‚Š", score: "æ¨å®šåç›Š", totalM: "åˆè¨ˆå€ç‡", boost: "ğŸ¬ æ‹¡æ•£ãƒ–ãƒ¼ã‚¹ãƒˆ", time: "â° å»¶é•·æ ç”³è«‹", 
            collab: "ğŸ¤ ã‚³ãƒ©ãƒœ", prank: "ğŸ‘» ãƒ‰ãƒƒã‚­ãƒª", resTitle: "é…ä¿¡ãƒªã‚¶ãƒ«ãƒˆ", resBase: "ã‚¹ãƒ‘ãƒãƒ£ç·é¡", resFinal: "æœ€çµ‚åç›Š", resShare: "ãƒã‚¹ãƒˆã™ã‚‹", resBack: "ã‚¿ã‚¤ãƒˆãƒ«ã¸",
            resBonus: "ç²å¾—æ¡ˆä»¶ãƒœãƒ¼ãƒŠã‚¹", buzz: "Buzz!", promo: "æ¡ˆä»¶", keep: "é…ä¿¡"
        },
        en: {
            best: "PERSONAL BEST", start: "START STREAM", turn: "Turns Left", score: "EST. REVENUE", totalM: "TOTAL MULTIPLIER", boost: "ğŸ¬ BOOST", time: "â° TIME", 
            collab: "ğŸ¤ COLLAB", prank: "ğŸ‘» PRANK", resTitle: "STREAM RESULT", resBase: "Base SuperChat", resFinal: "TOTAL REVENUE", resShare: "Share Result", resBack: "Title Screen",
            resBonus: "Sponsorship Bonus", buzz: "Buzz!", promo: "Promo", keep: "Keep"
        }
    };

    let curLang = localStorage.getItem('cm_lang') || 'ja';
    let turn, score, combo, level, resources, boostCount, recoverCount, isBoostActive, currentEnemy;

    function setLang(lang) {
        curLang = lang;
        localStorage.setItem('cm_lang', lang);
        document.getElementById('lang-ja').className = 'lang-btn' + (lang === 'ja' ? ' active' : '');
        document.getElementById('lang-en').className = 'lang-btn' + (lang === 'en' ? ' active' : '');
        applyLangStrings();
    }

    function applyLangStrings() {
        const t = UI_TEXT[curLang];
        document.getElementById('title-best-label').innerText = t.best;
        document.getElementById('btn-start-label').innerText = t.start;
        document.getElementById('ui-turn-label').innerText = t.turn;
        document.getElementById('ui-score-label').innerText = t.score;
        document.getElementById('ui-total-multiplier-label').innerText = t.totalM;
        document.getElementById('ui-collab-label').innerText = t.collab;
        document.getElementById('ui-prank-label').innerText = t.prank;
        document.getElementById('ui-res-title').innerText = t.resTitle;
        document.getElementById('ui-res-final-label').innerText = t.resFinal;
        document.getElementById('ui-res-share-label').innerText = t.resShare;
        document.getElementById('ui-res-title-label').innerText = t.resBack;
        updateUI();
    }

    function startGame() {
        document.getElementById('title-screen').style.display = 'none';
        turn = 30; score = 0; combo = 0; level = 1; resources = { red:0, blue:0, green:0 };
        boostCount = 3; recoverCount = 3; isBoostActive = false;
        spawnEnemy();
        updateUI(); 
    }

    function spawnEnemy() {
        currentEnemy = ENEMY_DATA[Math.floor(Math.random() * ENEMY_DATA.length)];
    }

    function calculateOutcome(pType) {
        if (!currentEnemy) return { score:0, res:0, label:"", type:"" };
        const eType = currentEnemy.id;
        let match = 'extract';
        if (eType === 'white' || eType === 'black') match = (pType === eType) ? 'advantage' : 'extract';
        else if (pType === 'white' || pType === 'black') match = 'extract';
        else if (pType === eType) match = 'advantage';
        else if ((eType === 'red' && pType === 'blue') || (eType === 'blue' && pType === 'green') || (eType === 'green' && pType === 'red')) match = 'neutral';

        const base = 100 * (1 + (level * 0.05));
        let s = 0, r = 0, lbl = UI_TEXT[curLang].promo;

        if (match === 'advantage') { s = Math.floor(base * (1 + (combo * 0.2))); r = 3; lbl = UI_TEXT[curLang].buzz; }
        else if (match === 'neutral') { s = Math.floor(base * 0.6 * (1 + (combo * 0.1))); r = 6; lbl = UI_TEXT[curLang].keep; }
        else { s = Math.floor(base * 0.2); r = (pType === 'white' || pType === 'black') ? 12 : 9; }
        
        if (isBoostActive) s *= 2;
        return { score: s, res: r, label: lbl, type: match };
    }

    function battle(pType) {
        if (turn <= 0) return;
        const out = calculateOutcome(pType);
        if (out.type !== 'extract') combo++; else combo = 0;
        if (pType === 'white' || pType === 'black') {
            resources.red += out.res/3; resources.blue += out.res/3; resources.green += out.res/3;
        } else resources[pType] += out.res;
        score += out.score; turn--; level++;
        if (out.type === 'advantage') Vibrate.short(); else if (out.type === 'neutral') Vibrate.medium();
        if (out.type === 'advantage' && Math.random() < 0.1 && recoverCount < 5) recoverCount++;
        if (out.type === 'extract' && Math.random() < 0.1 && boostCount < 5) boostCount++;
        isBoostActive = false;
        spawnEnemy();
        if (turn <= 0) showResult(); else updateUI();
    }

    function showResult() {
        const t = UI_TEXT[curLang];
        const pR = resources.red / 30; const pB = resources.blue / 30; const pG = resources.green / 30;
        const totalM = 1 + pR + pB + pG;
        const final = Math.floor(score * totalM);
        const grid = document.getElementById('ui-res-grid');
        grid.innerHTML = `
            <div class="res-item-row"><span>${t.resBase}</span><span>Â¥ ${score.toLocaleString()}</span></div>
            <div class="res-divider"></div>
            <div class="res-item-row"><span>Passion (ğŸ”¥)</span><span>${Math.floor(resources.red)} (+${pR.toFixed(2)}x)</span></div>
            <div class="res-item-row"><span>Cool    (â„ï¸)</span><span>${Math.floor(resources.blue)} (+${pB.toFixed(2)}x)</span></div>
            <div class="res-item-row"><span>Chill   (ğŸ€)</span><span>${Math.floor(resources.green)} (+${pG.toFixed(2)}x)</span></div>
            <div class="res-divider"></div>
            <div class="res-item-row"><span style="color:#ffd700">æœ€çµ‚å€ç‡ / Total Multiplier</span><span style="color:#ffd700">x ${totalM.toFixed(2)}</span></div>
            <div class="res-item-row"><span style="color:#ffd700">${t.resBonus}</span><span style="color:#ffd700">+ Â¥ ${(final - score).toLocaleString()}</span></div>
        `;
        document.getElementById('ui-res-final').innerText = final.toLocaleString();
        document.getElementById('result-overlay').style.display = 'flex';
        const hs = localStorage.getItem('cm_highscore_v1') || 0;
        if (final > hs) {
            localStorage.setItem('cm_highscore_v1', final);
            document.getElementById('new-record-msg').style.display = 'block';
        }
    }

    function updateUI() {
        const t = UI_TEXT[curLang];
        document.getElementById('ui-turn').innerText = turn;
        document.getElementById('ui-score').innerText = score.toLocaleString();
        document.getElementById('ui-combo').innerText = combo;
        document.getElementById('ui-level').innerText = level;
        document.getElementById('ui-res-red').innerText = Math.floor(resources.red);
        document.getElementById('ui-res-blue').innerText = Math.floor(resources.blue);
        document.getElementById('ui-res-green').innerText = Math.floor(resources.green);
        const rR = resources.red / 30; const rB = resources.blue / 30; const rG = resources.green / 30;
        document.getElementById('ui-rate-red').innerText = `+${rR.toFixed(2)}x`;
        document.getElementById('ui-rate-blue').innerText = `+${rB.toFixed(2)}x`;
        document.getElementById('ui-rate-green').innerText = `+${rG.toFixed(2)}x`;
        document.getElementById('ui-rate-total').innerText = (1 + rR + rB + rG).toFixed(2);
        
        document.getElementById('ui-btn-boost-label').innerText = `${t.boost} (L:${boostCount})`;
        document.getElementById('ui-btn-time-label').innerText = `${t.time} (L:${recoverCount})`;
        document.getElementById('boost-fx').style.display = isBoostActive ? 'block' : 'none';

        if (currentEnemy) {
            document.getElementById('ui-enemy-icon').innerText = currentEnemy.icon;
            document.getElementById('ui-enemy-name').innerText = currentEnemy[curLang].name;
            document.getElementById('ui-comment').innerText = currentEnemy[curLang].comment;
            document.getElementById('enemy-box').style.borderColor = currentEnemy.color;
        }

        ['red','blue','green','white','black'].forEach(type => {
            const out = calculateOutcome(type);
            document.getElementById(`btn-score-${type}`).innerText = `+Â¥${out.score.toLocaleString()}`;
            document.getElementById(`btn-lbl-${type}`).innerText = `${out.label} | +${out.res}`;
            const c = (out.type === 'advantage') ? "#f1c40f" : (out.type === 'neutral' ? "#fff" : "#88ccff");
            document.getElementById(`btn-score-${type}`).style.color = c;
            document.getElementById(`btn-lbl-${type}`).style.color = c;
        });
    }

    function useBooster(e) { if(boostCount > 0 && !isBoostActive) { boostCount--; isBoostActive = true; Vibrate.long(); updateUI(); } }
    function useRecover(e) { if(recoverCount > 0) { recoverCount--; turn++; Vibrate.long(); updateUI(); } }
    function backToTitle() { document.getElementById('result-overlay').style.display = 'none'; document.getElementById('title-screen').style.display = 'flex'; window.onload(); }
    function shareOnX() {
        const f = document.getElementById('ui-res-final').innerText;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(UI_TEXT[curLang].share.replace("{score}", f))}&url=${encodeURIComponent(window.location.href)}`, '_blank');
    }

    window.onload = () => {
        const hs = localStorage.getItem('cm_highscore_v1') || 0;
        document.getElementById('title-hs').innerText = parseInt(hs).toLocaleString();
        setLang(curLang);
    };
</script>
</body>
</html>
